<launch>
  <!-- Include Robot State Publisher
  <include file="$(find-pkg-share mr_pinchy_robot_bringup)/launch/rsp.launch.py">
    <arg name="use_sim_time" value="true" />
    <arg name="urdf" value="$(find-pkg-share mr_pinchy_robot_description)/urdf/my_first_robot.urdf.xacro" />
  </include> -->

<let name="urdf_path" value="$(find-pkg-share mr_pinchy_robot_description)/urdf/my_first_robot.urdf.xacro"/>

<!-- <let name="rviz_config_path" value="$(find-pkg-share my_robot_description)/rviz/urdf_config.rviz"/> -->
<node pkg="robot_state_publisher" exec="robot_state_publisher">
<param name="use_sim_time" value="true"/>

<param name="robot_description" value="$(command 'xacro $(var urdf_path)')"/>
</node>
  <!-- Launch Gazebo server -->
  <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name="gz_args" value="-r -s -v1 $(find-pkg-share mr_pinchy_robot_bringup)/worlds/empty.world" />
    <arg name="on_exit_shutdown" value="true" />
  </include>

  <!-- Launch Gazebo client -->
  <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name="gz_args" value="-g" />
  </include>


  <!-- Spawn robot into Gazebo -->
  <node pkg="ros_gz_sim" exec="create" name="spawn_diff_bot" output="screen" args="-topic robot_description -name diff_bot -z 0.2" />
<!-- <node pkg="ros_gz_sim" exec="create" name="spawn_diff_bot" output="screen"
      args="-file /tmp/my_first_robot.urdf -name diff_bot -z 0.2" /> -->

  <!-- Gazebo-ROS bridge -->
  <node pkg="ros_gz_bridge" exec="parameter_bridge" name="ros_gz_bridge" output="screen">
    <param name="config_file" value="$(find-pkg-share mr_pinchy_robot_bringup)/config/gz_bridge.yaml" />
  </node>


<node name="joint_state_broadcaster_spawner" pkg="controller_manager" exec="spawner" output="screen"
      args="joint_state_broadcaster --controller-manager /controller_manager" />

<node name="forward_position_controller_spawner" pkg="controller_manager" exec="spawner" output="screen"
      args="forward_position_controller --controller-manager /controller_manager" />

</launch>
